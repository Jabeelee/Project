<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.camflex.admin.reservation.dao.AdminReservationDAO">
	<resultMap id="reservationVO" type="com.camflex.client.reservation.vo.ReservationVO">
		<result column="r_number" property="r_number"/>
		<result column="m_id" property="m_id"/>
		<result column="p_number" property="p_number"/>
		<result column="r_startdate" property="r_startDate"/>
		<result column="r_enddate" property="r_endDate"/>
		<result column="r_price" property="r_price"/>
		<result column="r_state" property="r_state"/>
		<result column="c_agree" property="c_agree"/>
		<result column="p_u_agree" property="p_u_agree"/>
		<result column="p_i_agree" property="p_i_agree"/>
		<result column="a_agree" property="a_agree"/>
		<result column="r_apllicationdate" property="r_apllicationDate"/>
	</resultMap>
	<resultMap id="productVO"
		type="com.camflex.admin.product.vo.ProductVO">
		<result column="p_number" property="p_number" />
		<result column="p_type" property="p_type" />
		<result column="p_name" property="p_name" />
		<result column="p_price" property="p_price" />
		<result column="p_information" property="p_information" />
		<result column="p_mainphoto" property="p_mainphoto" />
		<result column="p_photo1" property="p_photo1" />
		<result column="p_photo2" property="p_photo2" />
		<result column="p_photo3" property="p_photo3" />
		<result column="p_date" property="p_date" />
	</resultMap>
	<resultMap id="memberVO" type="com.camflex.client.member.vo.MemberVO">
		<result column="m_id" property="m_id" />
		<result column="m_pw" property="m_pw" />
		<result column="m_name" property="m_name" />
		<result column="m_phone" property="m_phone" />
		<result column="m_birth" property="m_birth" />
		<result column="m_number" property="m_number" />
		<result column="m_date" property="m_date" />
	</resultMap>
	
	
	<resultMap id="adminReservation" type="com.camflex.admin.reservation.vo.AdminReservationVO">
		<collection property="ReservationVO" resultMap="reservationVO" />
		<collection property="ProductVO" resultMap="productVO" />
		<collection property="MemberVO" resultMap="memberVO"></collection>
	</resultMap>

	<!-- 검색 조건울 나타내는 쿼리 조각 -->
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'm'.toString()">
				and m_name like concat('%', concat(#{keyword}, '%'))
			</if>
			<if test="searchType == 'p'.toString()">
				and p_name like concat('%', concat(#{keyword}, '%'))
			</if>
		</if>
	</sql>
	<sql id="total_list">
		<if test="searchType == null">
			and rnum between #{sizePerPage} * #{page} - 9 and #{sizePerPage} * #{page}
		</if>
	</sql>
	
	<!-- 예약 리스트 -->
	<select id="reservationList" parameterType="reservation">
		
		SELECT r_number, p_name, m_name, r_price, r_apllicationdate, r_startdate, r_enddate, r_state
		FROM reservation_tbl, product_tbl, member_tbl
		WHERE reservation_tbl.p_number = product_tbl.p_number AND reservation_tbl.m_id = member_tbl.m_id
		ORDER BY r_number desc
		
	</select>
	<!-- 예액 전체 명수를 조회한다. -->
	<select id="count" resultType="int">
		<![CDATA[
		SELECT count(r_number)
		FROM reservation_tbl
		WHERE r_number > 0
		]]>
		<include refid="search"></include>
	</select>
</mapper>