<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.camflex.admin.member.dao.AdminMemberDAO">
	
	<!-- 회원 검색 쿼리 분리 -->
	<sql id="memberCommon">
		SELECT m_id, m_name, m_phone, m_date
		FROM member_tbl
		<where>
			<if test="search == 'm_name'">
				<![CDATA[m_name like '%'||#{keyword}||'%']]>
			</if>
			<if test="search == 'm_phone'">
				<![CDATA[m_phone like '%'||#{keyword}||'%']]>
			</if>
		</where>
	</sql>
	
	<!-- 회원 리스트(마스킹 처리) -->
	<select id="memberList" resultType="member">
		SELECT 
		m_id,
		REGEXP_REPLACE(m_name, '.', '*', 2, 1)as m_name,
		REGEXP_REPLACE(m_phone, '(\d{3})(\d{3,4})(\d{4})', '\1-****-\3')as m_phone,
		m_date
		FROM member_tbl
		ORDER BY m_date DESC
	</select>
	
	<!-- 회원 카운트 페이징 -->
	<select id="memberListCnt" parameterType="member" resultType="int">
		SELECT NVL(count(1), 0)FROM
		(		SELECT list.*, ROWNUM AS RNUM
				FROM(
								<include refid="memberCommon"></include>
								ORDER BY m_date desc
				)list
		)
	</select>
</mapper>